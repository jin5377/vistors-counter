<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>800만 카운트다운</title>
  <style>
    :root { --bg:#0b1020; --fg:#e8ecf1; --muted:#9aa6b2; --accent:#3aa3ff; --track:#1b2238; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:920px;margin:0 auto;padding:32px 20px;display:grid;gap:20px}
    h1{font-size:clamp(22px,4vw,34px);margin:0 0 8px}
    .kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .card{background:#0f1630;border:1px solid #1f2a44;border-radius:16px;padding:16px}
    .label{font-size:13px;color:var(--muted);letter-spacing:.2px}
    .value{font-variant-numeric:tabular-nums;line-height:1.1;font-weight:700;font-size:clamp(24px,4.5vw,40px)}
    .bar{height:18px;background:var(--track);border-radius:999px;overflow:hidden;border:1px solid #1f2a44}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#7ed3ff);}
    .note{color:var(--muted);font-size:14px}
    .footer{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:13px}
    .error{color:#ff9aa2}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>국립대구과학관 800만 카운트다운</h1>
      <p class="note" id="asof">데이터 로드 중…</p>
    </header>

    <section class="kpis" aria-label="누적 및 목표 현황">
      <div class="card" role="group" aria-labelledby="k1l">
        <div class="label" id="k1l">오늘 기준 누적</div>
        <div class="value" id="cum">-</div>
      </div>
      <div class="card" role="group" aria-labelledby="k2l">
        <div class="label" id="k2l">목표</div>
        <div class="value" id="target">8,000,000</div>
      </div>
      <div class="card" role="group" aria-labelledby="k3l">
        <div class="label" id="k3l">남은 인원</div>
        <div class="value" id="remain">-</div>
      </div>
      <div class="card" role="group" aria-labelledby="k4l">
        <div class="label" id="k4l">달성률</div>
        <div class="value" id="rate">-</div>
      </div>
    </section>

    <section aria-label="진행률 바">
      <div class="bar" aria-hidden="true"><div class="fill" id="fill"></div></div>
      <p class="sr-only" id="bar-label">달성률 진행 바</p>
    </section>

    <footer class="footer">
      <div>업데이트 방법: URL에 <code>?cum=7320000</code> 처럼 누적값을 넘기거나, 아래 임베디드 JSON의 <code>cumulative</code> 값을 바꿔 저장.</div>
      <div id="status"></div>
    </footer>
  </div>

  <!-- ① 단일 파일 사용 시, 이 JSON 블록의 cumulative 값을 매일 수정 후 업로드하세요.  -->
  <script type="application/json" id="daily">{
    "date": "2025-08-19",
    "cumulative": 7790000
  }</script>

  <script>
    const TARGET = 8000000;
    const $ = (id) => document.getElementById(id);
    const fmt = (n) => Number(n).toLocaleString('ko-KR');

    function setUI({date, cumulative}){
      const remain = Math.max(TARGET - Number(cumulative||0), 0);
      const rate = Math.max(Math.min((Number(cumulative||0)/TARGET)*100, 100), 0);
      $('cum').textContent = fmt(cumulative||0) + ' 명';
      $('target').textContent = fmt(TARGET);
      $('remain').textContent = fmt(remain) + ' 명';
      $('rate').textContent = rate.toFixed(2) + '%';
      $('asof').textContent = (date ? `${date} 기준` : '기준일 미상');
      $('fill').style.width = rate + '%';
      document.title = `800만까지 ${fmt(remain)}명 남음`;
    }

    async function loadData(){
      const status = $('status');
      try{
        // 우선순위 1: 쿼리스트링 ?cum=NNN
        const params = new URLSearchParams(location.search);
        const qsCum = params.get('cum');
        if(qsCum){
          const cum = Number(String(qsCum).replace(/[^0-9]/g,'')) || 0;
          setUI({date: new Date().toISOString().slice(0,10), cumulative: cum});
          status.textContent = '데이터 소스: URL 매개변수';
          return;
        }
        // 우선순위 2: 임베디드 JSON 블록
        const el = $('daily');
        if(el && el.textContent.trim()){
          const obj = JSON.parse(el.textContent);
          setUI({date: obj.date, cumulative: obj.cumulative});
          status.textContent = '데이터 소스: 임베디드 JSON';
          return;
        }
        // 우선순위 3: 동폴더 visitors.json 시도
        const res = await fetch('visitors.json', {cache:'no-store'});
        if(res.ok){
          const obj = await res.json();
          setUI({date: obj.date, cumulative: obj.cumulative});
          status.textContent = '데이터 소스: visitors.json';
          return;
        }
        throw new Error('데이터 소스 없음');
      }catch(e){
        $('asof').innerHTML = '<span class="error">데이터를 불러오지 못했습니다. URL 매개변수나 JSON을 설정하세요.</span>';
        $('cum').textContent = '-';
        $('remain').textContent = '-';
        $('rate').textContent = '-';
        $('fill').style.width = '0%';
        $('status').textContent = '오류: '+ e.message;
      }
    }

    loadData();
  </script>
</body>
</html>
