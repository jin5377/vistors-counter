<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>일일 증가분 입력</title>
  <style>
    :root { --bg:#0b1020; --fg:#e8ecf1; --muted:#9aa6b2; --accent:#3aa3ff; }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Apple SD Gothic Neo,Noto Sans KR,sans-serif}
    .wrap{max-width:640px;margin:0 auto;padding:28px 16px;display:grid;gap:16px}
    h1{font-size:clamp(20px,3.5vw,28px);margin:0 0 8px}
    .card{background:#0f1630;border:1px solid #1f2a44;border-radius:16px;padding:16px}
    label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
    input,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #2a375a;background:#0e1733;color:var(--fg)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    .note{color:var(--muted);font-size:13px}
    .ok{color:#9ff9b1}
    .err{color:#ff9aa2}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>국립대구과학관 800만 · 입력</h1>
      <p class="note">입력 단위: <strong>당일 입장 인원(일일 증가분)</strong>. 같은 날짜 입력은 마지막 값으로 반영됩니다(LWW).</p>
    </header>

    <section class="card">
      <div class="row">
        <div>
          <label for="date">날짜</label>
          <input type="date" id="date" required max="2025-08-20" />
        </div>

        <div>
          <label for="count">당일 입장 인원(일일 증가분)</label>
          <input type="number" id="count" inputmode="numeric" required min="1" placeholder="예: 1032" />
        </div>

        <div>
          <button id="submit">제출</button>
        </div>

        <div>
          <span id="status" class="note">대기 중</span>
        </div>
      </div>
    </section>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzhvDQtWL5S1WreuhPJiw7ODnv0KamWZHGVHBU0gsHInGkgPmBMpBQLv4J55q4CDT6qTQ/exec";

const $ = (s)=>document.querySelector(s);
const statusEl = $('#status');
const btn = $('#submit');

function setStatus(msg, cls='note'){ statusEl.textContent = msg; statusEl.className = cls; }

function validate(date, count){
  if(!/^\d{4}-\d{2}-\d{2}$/.test(date)) return '날짜 형식 오류';
  if(date > $('#date').max) return '미래 일자 불가';
  const n = Number(count);
  if(!Number.isFinite(n) || n < 1) return '인원은 1 이상';
  return null;
}

async function submit(){
  if(btn.disabled) return;
  const date = $('#date').value;
  const count = $('#count').value;
  const err = validate(date, count);
  if(err) return setStatus(err, 'note err');

  try{
    btn.disabled = true;
    setStatus('전송 중…');

    const payload = new URLSearchParams();
    payload.set('date', date);
    payload.set('count', String(Number(count)));

    const res = await fetch(SCRIPT_URL, { method:'POST', body: payload });
    const t = await res.text();
    let ok = false;
    try{ ok = res.ok && JSON.parse(t).status === 'ok'; }
    catch(_){ ok = res.ok && t.trim().toLowerCase() === 'ok'; }

    if(ok){ 
      // 저장 완료 시 index.html로 이동
      setStatus('저장 완료. 이동합니다…', 'note ok');
      setTimeout(() => { window.location.href = 'index.html'; }, 300);
    } else {
      throw new Error(t || '서버 오류');
    }
  } catch(e){
    setStatus('오류: '+ e.message, 'note err');
  } finally {
    btn.disabled = false;
  }
}

btn.addEventListener('click', submit);
</script>
</body>
</html>
